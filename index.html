<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GW2 Trading Post Baron</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ‚úÖ Tailwind CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- ‚úÖ Include DataTables CSS -->
  <link href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white min-h-screen p-6 font-sans">

  <!-- üåü Header -->
  <header class="text-center mb-8">
    <h1 class="text-4xl font-bold text-yellow-400 mb-2">GW2 Trading Post Baron</h1>
    <p class="text-yellow-300">Profit from the market like a true Tyrian overlord</p>
  </header>

  <!-- ‚ö†Ô∏è Disclaimer -->
  <div class="bg-yellow-800 text-yellow-200 p-4 rounded mb-6 text-sm max-w-2xl mx-auto">
    <p>This tool helps identify profitable items to craft and flip using live data from the Trading Post. Prices fluctuate rapidly. Use with caution.</p>
  </div>

  <!-- üìä Status -->
  <div class="text-center mb-4">
    <p id="crafting-status" class="text-blue-300 font-semibold">Loading crafting profits...</p>
  </div>

  <!-- üîç Search/Filters -->
  <div class="max-w-6xl mx-auto mb-4">
    <input id="tableSearch" type="text" placeholder="Search by name..." class="w-full p-2 rounded bg-gray-800 text-white border border-gray-600">
  </div>

  <!-- üì¶ Crafting Profits Table -->
  <div class="overflow-x-auto max-w-6xl mx-auto">
    <table id="profitsTable" class="display w-full text-sm">
      <thead class="bg-gray-800 text-yellow-300">
        <tr>
          <th>Recipe ID</th>
          <th>Recipe Name</th>
          <th>Recipe Ingredients</th>
          <th>Ingredient Names (Qty)</th>
          <th>Ingredient Cost</th>
          <th>Profit</th>
        </tr>
      </thead>
      <tbody id="crafting-body" class="text-gray-100">
        <!-- Rows inserted by JS -->
      </tbody>
    </table>
  </div>

  <!-- üìò Footer -->
  <footer class="text-center mt-10 text-xs text-gray-500">
    Built with ‚ù§Ô∏è by POG | Data via GW2 API | Not affiliated with ArenaNet
  </footer>

  <!-- ‚úÖ jQuery & DataTables JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

  <!-- ‚úÖ Load and render profits -->
  <script>
    const SHEET_API_URL = 'https://script.google.com/macros/s/AKfycbxU4ks-i_jhldboVik3ruG9spBfOzlcOEbKEFuRGwjapJS4I7wvG-Ng0ugv5FHK9sg/exec';

    async function loadCraftingProfits() {
      try {
        const res = await fetch(SHEET_API_URL);
        const data = await res.json();

        const profits = data?.CraftingProfits || [];

        const tbody = document.getElementById('crafting-body');
        tbody.innerHTML = ''; // Clear

        profits.forEach(row => {
          if (!Array.isArray(row)) return; // Defensive

          const tr = document.createElement('tr');
          row.forEach(cell => {
            const td = document.createElement('td');
            td.textContent = cell;
            td.className = 'border border-gray-700 px-2 py-1';
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });

        document.getElementById('crafting-status').innerText = `Showing ${profits.length} results.`;

        // Init DataTables
        $('#profitsTable').DataTable({
          paging: true,
          searching: false,
          info: false
        });
      } catch (err) {
        console.error('Error fetching data:', err);
        document.getElementById('crafting-status').innerText = '‚ùå Failed to load crafting profits';
      }
    }

    // Filter table with custom input
    $(document).on('input', '#tableSearch', function () {
      $('#profitsTable').DataTable().search(this.value).draw();
    });

    document.addEventListener('DOMContentLoaded', loadCraftingProfits);
  </script>
</body>
</html>
